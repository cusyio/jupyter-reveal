<!DOCTYPE html>
<html>
<head><meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="chrome=1" />

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />


<title>dvc slides</title><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>

<!-- General and theme style sheets -->
<link rel="stylesheet" href="https://unpkg.com/reveal.js@4.0.2/dist/reveal.css">
<link rel="stylesheet" href="../theme/jupyter.css">
<link rel="stylesheet" href="../theme/cusy.css" id="theme">

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
}
</script>

<!-- Loading the mathjax macro -->
<!-- Load mathjax -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-MML-AM_CHTML-full,Safe"> </script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    init_mathjax = function() {
        if (window.MathJax) {
        // MathJax loaded
            MathJax.Hub.Config({
                TeX: {
                    equationNumbers: {
                    autoNumber: "AMS",
                    useLabelIds: true
                    }
                },
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                    processEscapes: true,
                    processEnvironments: true
                },
                displayAlign: 'center',
                CommonHTML: {
                    linebreaks: {
                    automatic: true
                    }
                },
                "HTML-CSS": {
                    linebreaks: {
                    automatic: true
                    }
                }
            });

            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }
    }
    init_mathjax();
    </script>
    <!-- End of mathjax configuration -->

</head>

<body class="jp-Notebook" data-jp-theme-light="true" data-jp-theme-name="JupyterLab Light">

<div class="reveal">
<div class="slides"><section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h1 id="Versionskontrolle-in-ML-Projekten">Versionskontrolle in ML-Projekten<a class="anchor-link" href="#Versionskontrolle-in-ML-Projekten">&#182;</a></h1><p><img src="fho.png" alt="Portrait Frank Hofmann" style="float: left; width:256px; margin-right:32px; border-radius: 50%;"/></p>
<p>Frank Hofmann<br>Cusy GmbH, Berlin<br>enterPy, 6. Mai 2021</p>
<p><p style="clear: both; margin-bottom: 0;">
    <br>
    <img src="qrcode_enterpy-dvc.svg" alt="QR-Code" style="width:128px; margin: 20px 32px 0 0;"/>
    <br>
    <a href="https://de.slideshare.net/cusyio/dvcenterpy">de.slideshare.net/cusyio/dvcenterpy</a></p>
<p/>
</div>
</div></section></section><section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Installation">Installation<a class="anchor-link" href="#Installation">&#182;</a></h2>
<pre><code>$ pipenv install dvc[ssh]</code></pre>

</div>
</div><div class="fragment">
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h3 id="Extras">Extras<a class="anchor-link" href="#Extras">&#182;</a></h3><ul>
<li><code>[ssh]</code></li>
<li><code>[s3]</code></li>
<li><code>[gs]</code></li>
<li><code>[azure]</code></li>
<li><code>[oss]</code></li>
<li><code>[all]</code></li>
</ul>

</div>
</div></div></section></section><section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Projekt-erstellen">Projekt erstellen<a class="anchor-link" href="#Projekt-erstellen">&#182;</a></h2><div class="highlight"><pre><span></span>$ mkdir -p dvc-example/data
$ <span class="nb">cd</span> dvc-example
$ git init
$ dvc init
$ git add .dvc
$ git commit -m <span class="s2">&quot;Initialise DVC&quot;</span>
</pre></div>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<dl>
    <dt><code>dvc init</code></dt>
    <dd>erstellt ein Verzeichnis <code>.dvc/</code> mit <code>config</code>, <code>.gitignore</code> und <code>cache</code>-Verzeichnis.</dd>
    <dt><code>git commit</code></dt>
    <dd>stellt <code>.dvc/config</code> und <code>.dvc/.gitignore</code> unter Git-Versionskontrolle.</dd>
</dl>
</div>
</div></section></section><section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="DVC-konfigurieren">DVC konfigurieren<a class="anchor-link" href="#DVC-konfigurieren">&#182;</a></h2><p>Bevor DVC verwendet wird, sollte noch ein entfernter Speicherplatz (remote storage) eingerichtet werden, z.B. ein NFS-Mount.</p>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<div class="highlight"><pre><span></span>$ sudo mkdir -p /var/dvc-storage
$ dvc remote add -d <span class="nb">local</span> /var/dvc-storage
Setting <span class="s1">&#39;local&#39;</span> as a default remote.
$ git commit .dvc/config -m <span class="s2">&quot;Configure local remote&quot;</span>
<span class="o">[</span>master efaeb84<span class="o">]</span> Configure <span class="nb">local</span> remote
 <span class="m">1</span> file changed, <span class="m">4</span> insertions<span class="o">(</span>+<span class="o">)</span>
</pre></div>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p><dl>
    <dt><code>-d, --default</code></dt>
        <dd>Standardwert für den entfernten Speicherplatz
    <dt><code>local</code></dt>
    <dd>Name des entfernten Speicherplatz</dd>
    <dt><code>/var/dvc-storage</code></dt>
    <dd>URL des entfernten Speicherplatzes</dd></p>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Daneben werden noch weitere Protokolle unterstützt, die dem Pfad vorangestellt werden, u.a. <code>ssh:</code>, <code>hdfs:</code>, <code>https:</code>.</p>
<p>So kann beispielsweise einfach ein weterer entfernter Datenspeicher hinzugefügt werden mit:</p>
<div class="highlight"><pre><span></span>$ dvc remote add webserver https://dvc.cusy.io/myproject
</pre></div>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Die zugehörige Konfigurationsdatei <code>.dvc/config</code> sieht dann so aus:</p>
<div class="highlight"><pre><span></span><span class="k">[&#39;remote &quot;local&quot;&#39;]</span>
<span class="na">url</span> <span class="o">=</span> <span class="s">/var/dvc-storage</span>
<span class="k">[core]</span>
<span class="na">remote</span> <span class="o">=</span> <span class="s">local</span>
<span class="k">[&#39;remote &quot;webserver&quot;&#39;]</span>
<span class="na">url</span> <span class="o">=</span> <span class="s">https://dvc.cusy.io/myproject</span>
</pre></div>

</div>
</div></section></section><section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Daten-hinzuf&#252;gen">Daten hinzuf&#252;gen<a class="anchor-link" href="#Daten-hinzuf&#252;gen">&#182;</a></h2><div class="highlight"><pre><span></span>$ dvc get https://github.com/iterative/dataset-registry get-started/data.xml <span class="se">\</span>
    -o data/data.xml
$ dvc add data/data.xml
</pre></div>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<ol>
<li>Dies fügt die Datei <code>data/data.xml</code> in <code>data/.gitignore</code> hinzu</li>
<li>Die Meta-Angaben werden in <code>data/data.xml.dvc</code> geschrieben.</li>
</ol>
<p>Weitere Informationen zum Dateiformat der <code>*.dvc</code>-Datei erhaltet ihr unter <a href="https://dvc.org/doc/user-guide/dvc-file-format">DVC-File Format</a>.</p>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>In Git werden für die verschiedene Versionen eurer Projektdaten verwaltet indem Ihr die CVS-Datei hinzufügt:</p>
<div class="highlight"><pre><span></span>$ git add data/.gitignore data/fortune500.csv.dvc
$ git commit -m <span class="s2">&quot;Add raw data to project&quot;</span>
</pre></div>

</div>
</div></section></section><section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Daten-speichern-und-abrufen">Daten speichern und abrufen<a class="anchor-link" href="#Daten-speichern-und-abrufen">&#182;</a></h2><p>Die Daten können vom Arbeitsverzeichnis eures Git-Repository auf den entfernten Speicherplatz kopiert werden mit</p>
<div class="highlight"><pre><span></span>$ dvc push
</pre></div>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Falls ihr aktuellere Daten abrufen wollt, könnt ihr dies mit</p>
<div class="highlight"><pre><span></span>$ dvc pull
</pre></div>

</div>
</div></section></section><section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Importieren-und-Aktualisieren">Importieren und Aktualisieren<a class="anchor-link" href="#Importieren-und-Aktualisieren">&#182;</a></h2>
</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h3 id="dvc-import"><code>dvc import</code><a class="anchor-link" href="#dvc-import">&#182;</a></h3>
</div>
</div><div class="fragment">
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Beispiel</p>
<div class="highlight"><pre><span></span>$ dvc import https://github.com/iterative/dataset-registry  get-started/data.xml
Importing <span class="s1">&#39;get-started/data.xml (https://github.com/iterative/dataset-registry)&#39;</span> -&gt; <span class="s1">&#39;data.xml&#39;</span>
</pre></div>

</div>
</div></div><div class="fragment">
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<ol>
<li>Dies lädt die Datei aus der <a href="https://github.com/iterative/dataset-registry">dataset-registry</a> in das aktuelle Arbeitsverzeichnis</li>
<li>fügt sie der <code>.gitignore</code>-Datei hinzu</li>
<li>erstellt die Datei <code>data.xml.dvc</code></li>
</ol>

</div>
</div></div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h3 id="dvc-update"><code>dvc update</code><a class="anchor-link" href="#dvc-update">&#182;</a></h3>
</div>
</div><div class="fragment">
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Beispiel</p>
<div class="highlight"><pre><span></span>$ dvc update data.xml.dvc
Stage <span class="s1">&#39;data.xml.dvc&#39;</span> didn<span class="s1">&#39;t change.</span>
<span class="s1">Saving information to &#39;</span>data.xml.dvc<span class="err">&#39;</span>.
</pre></div>

</div>
</div></div></section></section><section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Big-Picture">Big Picture<a class="anchor-link" href="#Big-Picture">&#182;</a></h2><p><img src="combine-git-dvc_1.svg" alt="Code und Daten verbinden"></p>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Big-Picture">Big Picture<a class="anchor-link" href="#Big-Picture">&#182;</a></h2><p><img src="combine-git-dvc_2.svg" alt="Code und Daten verbinden"></p>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Big-Picture">Big Picture<a class="anchor-link" href="#Big-Picture">&#182;</a></h2><p><img src="combine-git-dvc_3.svg" alt="Code und Daten verbinden"></p>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Big-Picture">Big Picture<a class="anchor-link" href="#Big-Picture">&#182;</a></h2><p><img src="combine-git-dvc_4.svg" alt="Code und Daten verbinden"></p>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Big-Picture">Big Picture<a class="anchor-link" href="#Big-Picture">&#182;</a></h2><p><img src="combine-git-dvc_5.svg" alt="Code und Daten verbinden"></p>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Big-Picture">Big Picture<a class="anchor-link" href="#Big-Picture">&#182;</a></h2><p><img src="combine-git-dvc_6.svg" alt="Code und Daten verbinden"></p>

</div>
</div></section></section><section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Pipelines">Pipelines<a class="anchor-link" href="#Pipelines">&#182;</a></h2><p><code>dvc run</code> erstellt Verarbeitungsstufen.</p>
<p>Jede Stufe ist gekennzeichnet durch</p>
<ul>
<li>eine, mit Git verwaltete, Quellcode-Datei</li>
<li>weitere Abhängigkeiten</li>
<li>Ausgabedaten</li>
</ul>
<p>Alle Stufen zusammen bilden die DVC-Pipeline.</p>

</div>
</div></section></section><section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Beispiel">Beispiel<a class="anchor-link" href="#Beispiel">&#182;</a></h2><p><a href="https://github.com/cusyio/dvc-example">github.com/cusyio/dvc-example</a></p>

</div>
</div></section></section><section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h3 id="1.-Phase:-Aufteilen-in-Trainings--und-Testdaten">1. Phase: Aufteilen in Trainings- und Testdaten<a class="anchor-link" href="#1.-Phase:-Aufteilen-in-Trainings--und-Testdaten">&#182;</a></h3>
</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p><a href="https://github.com/cusyio/dvc-example/blob/main/src/split.py">dvc-example/src/split.py</a></p>

</div>
</div><div class="fragment">
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<div class="highlight"><pre><span></span>$ dvc run -n split -d src/split.py -d data/data.xml -o data/splitted <span class="se">\</span>
    python src/split.py data/data.xml
</pre></div>

</div>
</div></div><div class="fragment">
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<dl>
    <dt><code>-n</code></dt>
    <dd>gibt den Namen der Verarbeitungsstufe an.</dd>
</dl>
</div>
</div></div><div class="fragment">
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<dl>
    <dt><code>-d</code></dt>
    <dd>gibt Abhängigkeiten (dependencies) für das reproduzierbare Kommando an.<br><br>
    Wenn zum Reproduzieren der Ergebnisse beim nächsten Mal <code>dvc repo</code> aufgerufen wird, überprüft DVC diese Abhängigkeiten und entscheidet, ob diese auf dem aktuellen Stand sond oder erneut ausgeführt werden müssen um aktuellere Ergebnisse zu erhalten.
</dd>
</dl>
</div>
</div></div><div class="fragment">
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<dl>
    <dt><code>-o</code></dt>
    <dd>gibt die Ausgabedatei oder das Ausgabeverzeichnis an.</dd>
</dl>
</div>
</div></div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Der Arbeitsbereich hat sich nun geändert in:</p>
<div class="highlight"><pre><span></span>.
  ├── data
  │   ├── data.xml
  │   ├── data.xml.dvc
+ │   └── splitted
+ │       ├── test.tsv
+ │       └── train.tsv
+ ├── dvc.lock
+ ├── dvc.yaml
  ├── requirements.txt
  └── src
      └── split.py
</pre></div>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Die generierte <code>dvc.yaml</code>-Datei sieht dann folgendermaßen aus:</p>
<div class="highlight"><pre><span></span><span class="nt">stages</span><span class="p">:</span>
  <span class="nt">split</span><span class="p">:</span>
    <span class="nt">cmd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pipenv run python src/split.py data/data.xml</span>
    <span class="nt">deps</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">data/data.xml</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">src/split.py</span>
    <span class="nt">outs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">data/splitted</span>
</pre></div>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Da die Daten im Ausgabeverzeichnis nie mit Git versioniert werden sollten, hat <code>dvc run</code> bereits die <code>data/.gitignore</code>-Datei geschrieben:</p>
<div class="highlight"><pre><span></span><span class="na">/data.xml</span>
<span class="na">+ /splitted</span>
</pre></div>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Anschließend müssen die geänderten Daten nur noch in Git bzw. DVC übernommen werden:</p>
<div class="highlight"><pre><span></span>$ git add data/.gitignore dvc.yaml
$ git commit -m <span class="s2">&quot;Create split stage&quot;</span>
$ dvc push
</pre></div>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Werden nun mehrere Phasen mit <code>dvc run</code> erstellt, wobei die Ausgabe eines Kommandos als Abhängigkeit eines anderen angegeben wird, entsteht eine DVC Pipeline.</p>

</div>
</div></section></section><section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h3 id="2.-Phase:-Parametrisierung">2. Phase: Parametrisierung<a class="anchor-link" href="#2.-Phase:-Parametrisierung">&#182;</a></h3>
</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p><code>params.yaml</code> mit folgendem Inhalt:</p>
<div class="highlight"><pre><span></span><span class="nt">max_features</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">6000</span>
<span class="nt">ngram_range</span><span class="p">:</span>
  <span class="nt">lo</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">hi</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
</pre></div>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p><code>dvc run</code> mit <code>-p &lt;filename&gt;:&lt;params_list&gt;</code> liest die Parameter, in unserem Beispiel:</p>
<div class="highlight"><pre><span></span>$ dvc run -n featurize -d src/featurization.py -d data/splitted <span class="se">\</span>
    -p params.yaml:max_features,ngram_range.lo,ngram_range.hi -o data/features <span class="se">\</span>
    python src/featurization.py data/splitted data/features
</pre></div>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Dies ergänzt die <code>dvc.yaml</code>-Datei um den <code>featurize</code>-Abschnitt:</p>
<div class="highlight"><pre><span></span><span class="nt">featurize</span><span class="p">:</span>
  <span class="nt">cmd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python src/featurization.py data/splitted data/features</span>
  <span class="nt">deps</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">data/splitted</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">src/featurization.py</span>
  <span class="nt">params</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">max_features</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ngram_range.lo</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ngram_range.hi</span>
  <span class="nt">outs</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">data/features</span>
</pre></div>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Damit diese Phase wiederholt werden kann, werden die MD5-Hashwerte und Parameterwerte in der <code>dvc.lock</code>-Datei gespeichert:</p>
<div class="highlight"><pre><span></span><span class="nt">featurize</span><span class="p">:</span>
  <span class="nt">cmd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python src/featurization.py data/splitted data/features</span>
  <span class="nt">deps</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">data/splitted</span>
    <span class="nt">md5</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1ce9051bf386e57c03fe779d476d93e7.dir</span>
  <span class="p p-Indicator">-</span> <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">src/featurization.py</span>
    <span class="nt">md5</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">a56570e715e39134adb4fdc779296373</span>
  <span class="nt">params</span><span class="p">:</span>
    <span class="nt">params.yaml</span><span class="p">:</span>
      <span class="nt">max_features</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1000</span>
      <span class="nt">ngram_range.hi</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
      <span class="nt">ngram_range.lo</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
</pre></div>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Schließlich müssen noch die folgenden Dateien im Git-Repository aktualisiert werden:</p>
<ul>
<li><code>dvc.lock</code></li>
<li><code>dvc.yaml</code></li>
<li><code>data/.gitignore</code></li>
</ul>
<div class="highlight"><pre><span></span>$ git add dvc.lock dvc.yaml data/.gitignore
</pre></div>

</div>
</div></section></section><section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h3 id="3.-Phase:-Evaluation">3. Phase: Evaluation<a class="anchor-link" href="#3.-Phase:-Evaluation">&#182;</a></h3>
</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p><a href="https://github.com/cusyio/dvc-example/blob/main/src/evaluate.py">dvc-example/src/evaluate.py</a> berechnet den Wert für die <a href="https://de.wikipedia.org/wiki/Fl%C3%A4che_unter_der_Kurve">Fläche unter der Kurve</a> (engl.: AUC (<strong>A</strong>rea <strong>U</strong>nder the <strong>C</strong>urve).</p>

</div>
</div><div class="fragment">
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Dabei verwendet es den Testdatensatz, ließt die Features aus <code>features/test.pkl</code> und erstellt die Metrikdatei <code>auc.metric</code>.</p>

</div>
</div></div><div class="fragment">
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p><code>auc.metric</code> kann DVC als Metrik mit der <code>-M</code>-Option von <code>dvc run</code> kenntlich gemacht werden:</p>

</div>
</div></div><div class="fragment">
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<div class="highlight"><pre><span></span>$ dvc run -n evaluate -d src/evaluate.py -d model.pkl -d data/features <span class="se">\</span>
    -M auc.json python src/evaluate.py model.pkl data/features auc.json
</pre></div>

</div>
</div></div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Dies erweitert die <code>/dvc.yaml</code>-Datei um den <code>evaluate</code>-Abschnitt:</p>
<div class="highlight"><pre><span></span><span class="nt">evaluate</span><span class="p">:</span>
  <span class="nt">cmd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python src/evaluate.py model.pkl data/features auc.json</span>
  <span class="nt">deps</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">data/features</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">model.pkl</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">src/evaluate.py</span>
  <span class="nt">metrics</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">auc.json</span><span class="p">:</span>
      <span class="nt">cache</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Versuchsmetriken">Versuchsmetriken<a class="anchor-link" href="#Versuchsmetriken">&#182;</a></h2><p>Mit <code>dvc metrics show</code> lassen sich Experimente über verschiedene Branches und Tags hinweg vergleichen:</p>

</div>
</div><div class="fragment">
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<div class="highlight"><pre><span></span>$ dvc metrics show
        auc.json: <span class="m">0</span>.514172
</pre></div>

</div>
</div></div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Die DVC-Pipeline kann nun zusammen mit einem Tag dem Git-Repository hinzugefügt werden:</p>
<div class="highlight"><pre><span></span>$ git add dvc.yaml dvc.lock auc.json
$ git commit -m <span class="s1">&#39;Add stage ‹evaluate›&#39;</span>
$ git tag -a <span class="m">0</span>.1.0 -m <span class="s2">&quot;Initial pipeline version 0.1.0&quot;</span>
</pre></div>

</div>
</div></section></section><section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Pipelines-anzeigen">Pipelines anzeigen<a class="anchor-link" href="#Pipelines-anzeigen">&#182;</a></h2><div class="highlight"><pre><span></span>$ dvc dag

    +-------------------+
    <span class="p">|</span> data/data.xml.dvc <span class="p">|</span>
    +-------------------+
              *
              *
              *
          +-------+
          <span class="p">|</span> split <span class="p">|</span>
          +-------+
              *
              *
              *
        +-----------+
        <span class="p">|</span> featurize <span class="p">|</span>
        +-----------+
         **        **
       **            *
      *               **
+-------+               *
<span class="p">|</span> train <span class="p">|</span>             **
+-------+            *
         **        **
           **    **
             *  *
        +----------+
        <span class="p">|</span> evaluate <span class="p">|</span>
        +----------+

data/data.xml.dvc
prepare.dvc
featurize.dvc
train.dvc
evaluate.dvc
</pre></div>

</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p><code>dvc dag --dot</code> generiert eine <a href="http://www.graphviz.org/">Graphviz</a>-<code>.dot</code>-Datei, die dann z.B. als SVG-Datei gerendert werden kann:</p>
<p><img src="pipeline.svg" alt="DVC-Pipeline"></p>

</div>
</div></section></section><section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Ergebnisse-reproduzieren">Ergebnisse reproduzieren<a class="anchor-link" href="#Ergebnisse-reproduzieren">&#182;</a></h2>
</div>
</div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h3 id="1.-Code-und-Daten-wiederherstellen">1. Code und Daten wiederherstellen<a class="anchor-link" href="#1.-Code-und-Daten-wiederherstellen">&#182;</a></h3>
</div>
</div><div class="fragment">
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<div class="highlight"><pre><span></span>$ git clone https://github.com/veit/dvc-example.git
$ <span class="nb">cd</span> dvc-example
$ dvc pull -TR
A       data/data.xml
<span class="m">1</span> file added
$ ls data/
data.xml    data.xml.dvc
</pre></div>

</div>
</div></div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h3 id="2.-Ergebnisse-reproduzieren">2. Ergebnisse reproduzieren<a class="anchor-link" href="#2.-Ergebnisse-reproduzieren">&#182;</a></h3>
</div>
</div><div class="fragment">
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<div class="highlight"><pre><span></span>$ dvc repro
Verifying data sources <span class="k">in</span> stage: <span class="s1">&#39;data/data.xml.dvc&#39;</span>
Stage <span class="s1">&#39;split&#39;</span> didn<span class="s1">&#39;t change, skipping</span>
<span class="s1">Stage &#39;</span>featurize<span class="s1">&#39; didn&#39;</span>t change, skipping
Stage <span class="s1">&#39;train&#39;</span> didn<span class="s1">&#39;t change, skipping</span>
<span class="s1">Stage &#39;</span>evaluate<span class="s1">&#39; didn&#39;</span>t change, skipping
</pre></div>

</div>
</div></div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h3 id="3.-Parametrisieren">3. Parametrisieren<a class="anchor-link" href="#3.-Parametrisieren">&#182;</a></h3>
</div>
</div><div class="fragment">
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Die Parameter in der <code>params.yaml</code>-Datei können geändert und anschließend die Pipeline erneut durchlaufen werden:</p>
<div class="highlight"><pre><span></span>$ dvc repro
Stage <span class="s1">&#39;data/data.xml.dvc&#39;</span> didn<span class="s1">&#39;t change, skipping</span>
<span class="s1">Stage &#39;</span>split<span class="s1">&#39; didn&#39;</span>t change, skipping
Running stage <span class="s1">&#39;featurize&#39;</span> with command:
    python src/featurization.py data/splitted data/features
…
Stage <span class="s1">&#39;train&#39;</span> didn<span class="s1">&#39;t change, skipping</span>
<span class="s1">Stage &#39;</span>evaluate<span class="s1">&#39; didn&#39;</span>t change, skipping
To track the changes with git, run:
    git add dvc.lock
</pre></div>

</div>
</div></div></section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<p>Die Änderung der Parameter hatte keinen Einfluss auf das Ergebnis.</p>
<p>DVC erkennt Änderungen an Abhängigkeiten und Ausgaben über die md5-Hashwerte, die in der <code>dvc.lock</code>-Datei gespeichert sind.</p>

</div>
</div></section></section><section><section>
<div class="jp-Cell-inputWrapper"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput " data-mime-type="text/markdown">
<h2 id="Zum-Weiterlesen">Zum Weiterlesen<a class="anchor-link" href="#Zum-Weiterlesen">&#182;</a></h2><ul>
<li><a href="https://jupyter-tutorial.readthedocs.io/de/latest/productive/dvc/index.html">DVC im Jupyter-Tutorial</a></li>
<li><a href="https://dvc.org/doc">Documentation</a><ul>
<li><a href="https://dvc.org/doc/command-reference/params">params</a></li>
</ul>
</li>
<li><a href="https://github.com/iterative/dvc">Git Repository</a></li>
</ul>

</div>
</div></section></section>
</div>
</div>
</body>


<script>
require(
    {
      // it makes sense to wait a little bit when you are loading
      // reveal from a cdn in a slow connection environment
      waitSeconds: 15
    },
    [
      "https://unpkg.com/reveal.js@4.0.2/dist/reveal.js"
    ],

    function(Reveal){
        // Full list of configuration options available here: https://github.com/hakimel/reveal.js#configuration
        Reveal.initialize({
            controls: true,
            progress: true,
            history: true,
            transition: "slide",
        });

        var update = function(event){
          if(MathJax.Hub.getAllJax(Reveal.getCurrentSlide())){
            MathJax.Hub.Rerender(Reveal.getCurrentSlide());
          }
        };

        Reveal.addEventListener('slidechanged', update);

        function setScrollingSlide() {
            var scroll = false
            if (scroll === true) {
              var h = $('.reveal').height() * 0.95;
              $('section.present').find('section')
                .filter(function() {
                  return $(this).height() > h;
                })
                .css('height', 'calc(95vh)')
                .css('overflow-y', 'scroll')
                .css('margin-top', '20px');
            }
        }

        // check and set the scrolling slide every time the slide change
        Reveal.addEventListener('slidechanged', setScrollingSlide);
    }
);
</script>

</html>
